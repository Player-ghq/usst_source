/**********************????51?????************************
*  ??:STC89C52
*  ??:????????5-1
*  ??:11.0592MHZ	 
******************************************************************/
		ORG    0000H
		LJMP   MAIN

		ORG     30H
MAIN:  MOV   	P3,#0F0H     ;????????
       MOV     	R1,#00       ;R1??????
	   MOV   	R7,#0FFH     ;??????
KEY1:  DJNZ  	R7,KEY1      ;????

LOOP:  MOV   	P3,#0F0H     ;????????
	   MOV   	A,P3         ;??P1????
       CPL   	A            ;???,?????????
       ANL   	A,#0F0H      ;?????????
       JZ    	EKEY         ;????:??,????????
       LCALL  	DEL20ms      ;????:??20 ms???
       MOV   	A,P3         ;??P1????
       CPL   	A            ;???,?????????
       ANL   	A,#0F0H      ;?????????
       JZ    	EKEY         ;????:???,??????????
SKEY:  MOV     	A,#00        ;???????,1?1??
	   MOV      R0,A          ;R0??????(X),???0
       MOV     	R2,A         ;R2??????(Y),???0
       MOV     	R1,#00       ;R1??????
       MOV  	R3,#0FEH     ;R3??????,?4??????,0?
SKEY2: MOV     	A,R3
       MOV     	P3,A         ;??????,?4??1
       NOP
	   NOP
       NOP                   ;3?NOP???P1?????
	   MOV		A,P3         ;???
	   MOV		R1,A         ;????
	   CPL		A            ;????????
	   ANL		A,#0F0H      ;???
S123: JNZ		SKEY3        ;??????:?SKEY3	??????
       INC		R0           ;??????:?????1
       SETB		C            ;????????1?,
	   MOV		A,R3         ;R3???C??1?
	   RLC		A			 ;?????????R3
	   MOV		R3,A       
	   MOV		A,R0
	   CJNE		A,#04H,SKEY2 ;?????(4?)????
EKEY:  NOP
	   LCALL   DISPLAY
	   AJMP    LOOP
                			 ;??(R2)??
SKEY3:  MOV 	A,R1
		JNB		ACC.4,SKEY5
		JNB		ACC.5,SKEY6
		JNB		ACC.6,SKEY7
		JNB		ACC.7,SKEY8
		AJMP	EKEY

SKEY5:	MOV		A,#00H
		MOV		R2,A         ;?0??
		AJMP	DKEY

SKEY6:  MOV		A,#01H
		MOV		R2,A         ;?1??
		AJMP	DKEY

SKEY7:	MOV		A,#02H
		MOV		R2,A         ;?2??
		AJMP	DKEY

SKEY8:	MOV		A,#03H
		MOV		R2,A         ;?3??
		AJMP	DKEY
                            ;?????
DKEY:   ACALL	DECODE
		AJMP	EKEY
;**************************************
;???
;**************************************
				      		;??(??)?????
DECODE: MOV	 	A,R0       	;????A
		MOV	 	B,#04H     	;???????
		MUL	 	AB          ;??×???
		ADD	 	A,R2       	;??×???+??=??
		MOV    	R1,A        ;????
		RET
;**************************************
;?????20ms??
;**************************************
DEL20ms:MOV     R4,#040
D1:		MOV		R5,#0FFH
D2:		DJNZ	R5,D2
		DJNZ	R4,D1
		RET
;**************************************
;**************************************
/****????,?????*****/	
;**************************************
DISPLAY:	
	MOV		A,R1
	MOV		DPTR,#TAB       ;???????DPTR
	MOVC	A,@A+DPTR       ;????
	MOV		P0,A            ;????
	SETB    P2.6            ;????
	NOP
	NOP
	CLR     P2.6
	MOV		A,#01FH         ;????
	MOV		P0,A           ;????
	SETB    P2.7	       ;????
	NOP
	NOP
	CLR     P2.7
	RET

TAB:DB		3FH,06H,5BH,4FH,66H,6DH,7DH,07H,7FH
	DB		6FH,77H,7CH,39H,5EH,79H,71H,40H,00H
;**************************************
	END
