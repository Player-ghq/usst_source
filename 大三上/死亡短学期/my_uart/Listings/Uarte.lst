C51 COMPILER V9.60.0.0   UARTE                                                             08/31/2022 09:36:25 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE UARTE
OBJECT MODULE PLACED IN .\Objects\Uarte.obj
COMPILER INVOKED BY: D:\MyFile\Keil_v5\DMK\C51\BIN\C51.EXE Uarte.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\L
                    -istings\Uarte.lst) OBJECT(.\Objects\Uarte.obj)

line level    source

   1          #define SYS_CLK 11059200L//设置定时器、串口频率参数
   2          
   3          #include <reg52.h>
   4          #include <stdio.h>
   5          #include "delay.h"
   6          
   7          #define uint16_t unsigned int 
   8          #define uint8_t unsigned char 
   9                  
  10          
  11          uint8_t Data[10];
  12          uint8_t count=0;
  13          
  14          //设置波特率
  15          void UartInit(void)     //2400bps@11.0592MHz
  16          {
  17   1        SCON = 0x50;
  18   1        TMOD |= 0x20;
  19   1        PCON |= 0x80;
  20   1        TH1 = 0xe8;
  21   1        TL1 = TH1;
  22   1        TR1 = 1;
  23   1        REN = 1;
  24   1      }
  25          
  26          
  27          void UART_T (unsigned char UART_data){  //定义串口发送数据变量
  28   1        SBUF = UART_data;             //将接收的数据发送回去
  29   1        while(TI == 0);               //检查发送中断标志位
  30   1        TI = 0;                               //令发送中断标志位为0（软件清零）
  31   1      }
  32          //将float的数转化为字符串
  33          void Get_Group_Len(float number)
  34          {
  35   1              unsigned char bufData[20]="00000";
  36   1              int i;
  37   1          sprintf(bufData, "%0.5f", number);//将小数转化为字符数组
  38   1          for(i=0;i<10;i++){
  39   2            UART_T(bufData[i]);//将字符发送到串口终端上去
  40   2          }
  41   1              
  42   1      }
  43          
  44          //串口中断函数，当串口接收到一个字符时触发该中断
  45          void UART_R(void) interrupt 4 using 1{
  46   1        if(RI){                               //中断标志
  47   2          RI = 0;                             //清除中断
  48   2                Data[count++]=SBUF;//将获取串口的值存放到数组中
  49   2                if(count>10)count=0;//若接收到的值大于10个字符后，清除数据等到下一次接收
  50   2          UART_T(SBUF);
  51   2        }
  52   1      }
  53          
  54          //初始化函数
C51 COMPILER V9.60.0.0   UARTE                                                             08/31/2022 09:36:25 PAGE 2   

  55          void setup(void)
  56          {
  57   1        UartInit();
  58   1        EA = 1;
  59   1        ES = 1;
  60   1      }
  61          
  62          void main(void)
  63          {
  64   1        setup();//初始化
  65   1        while(1){
  66   2              Get_Group_Len(34.567);//传入小数
  67   2              delay(2000);
  68   2        }
  69   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    245    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11      24
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
